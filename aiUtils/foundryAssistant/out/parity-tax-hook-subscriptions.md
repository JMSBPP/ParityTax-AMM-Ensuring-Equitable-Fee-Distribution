# ParityTaxHook Event Subscriptions

## Overview
This document explains the event subscription system implemented in `ParityTaxHookSubscriptions.sol` for monitoring all events emitted by the `IParityTaxHook` interface.

## Subscription System Architecture

The subscription system creates encoded function calls for subscribing to specific events on the ParityTaxHook contract. Each subscription follows a standardized format with the following parameters:

### Subscription Function Signature
```solidity
subscribe(uint256,address,uint256,uint256,uint256,uint256)
```

### Parameters
1. **chainId** (uint256): The blockchain chain ID where the hook is deployed
2. **contractAddress** (address): The address of the ParityTaxHook contract
3. **topic0** (uint256): The event topic0 (keccak256 hash of event signature)
4. **topic1** (uint256): First indexed parameter filter (REACTIVE_IGNORE for wildcard)
5. **topic2** (uint256): Second indexed parameter filter (REACTIVE_IGNORE for wildcard)
6. **topic3** (uint256): Third indexed parameter filter (REACTIVE_IGNORE for wildcard)

## Event Subscriptions

### 1. PriceImpact Event
- **Topic0**: `0x5893daed40175f5b967e0d8330bb4645462baa4dd943a1d477970a09005d0eba`
- **Indexed Parameters**: `poolId`, `blockNumber`, `swapIntent`
- **Purpose**: Monitors price impact during swaps

### 2. LiquidityOnSwap Event
- **Topic0**: `0xc8880b3ae9558df3a51b833923827bbd2f9ba44a9e301b9fc30c9ebc9b74f98a`
- **Indexed Parameters**: `poolId`, `blockNumber`
- **Purpose**: Tracks liquidity changes during swaps

### 3. LiquidityCommitted Event
- **Topic0**: `0xcec8de8a7601b90797cedff00dcb85732045825d1bf02308be5874f59bc616d4`
- **Indexed Parameters**: `poolId`, `blockNumber`, `commitment`, `owner`
- **Purpose**: Monitors liquidity commitment events
- **Note**: This event is marked as `anonymous`

### 4. Remittance Event
- **Topic0**: `0x58dfacde9fc85654a0cc8143d1b2311ae404acab04d626a660c0a45db26c891c`
- **Indexed Parameters**: `poolId`, `currentBlock`, `blockCommitment`
- **Purpose**: Tracks fee revenue distribution

## Constants

```solidity
uint256 constant REACTIVE_IGNORE = 0xa65f96fc951c35ead38878e0f0b7a3c744a6f5ccc1476b313353ce31712313ad;
uint256 constant PRICE_IMPACT_TOPIC0 = 0x5893daed40175f5b967e0d8330bb4645462baa4dd943a1d477970a09005d0eba;
uint256 constant LIQUIDITY_ON_SWAP_TOPIC0 = 0xc8880b3ae9558df3a51b833923827bbd2f9ba44a9e301b9fc30c9ebc9b74f98a;
uint256 constant LIQUIDITY_COMMITTED_TOPIC0 = 0xcec8de8a7601b90797cedff00dcb85732045825d1bf02308be5874f59bc616d4;
uint256 constant REMITTANCE_TOPIC0 = 0x58dfacde9fc85654a0cc8143d1b2311ae404acab04d626a660c0a45db26c891c;
uint256 constant NUMBER_EVENTS = 4;
```

## Usage Example

```solidity
// Get all subscriptions for a specific chain
IParityTaxHook hook = IParityTaxHook(hookAddress);
uint256 chainId = 1; // Ethereum mainnet

bytes[] memory subscriptions = ParityTaxHookSubscriptions.getSubscriptions(hook, chainId);

// Execute subscriptions (example with multicall)
for (uint256 i = 0; i < subscriptions.length; i++) {
    // Execute subscription[i] via your subscription service
    subscriptionService.execute(subscriptions[i]);
}
```

## Implementation Details

### getSubscriptions Function
```solidity
function getSubscriptions(
    IParityTaxHook _parityTaxHook,
    uint256 _chainId
) internal view returns(bytes[] memory)
```

**Returns**: Array of encoded subscription calls for all 4 events

**Features**:
- Creates subscription payloads for all ParityTaxHook events
- Uses `REACTIVE_IGNORE` for wildcard filtering on indexed parameters
- Automatically includes the hook contract address
- Returns ready-to-execute encoded function calls

## Event Filtering Strategy

All subscriptions use `REACTIVE_IGNORE` for topic1, topic2, and topic3 parameters, which means:
- **Wildcard Filtering**: Captures all events regardless of indexed parameter values
- **Maximum Coverage**: Ensures no events are missed due to specific parameter filtering
- **Flexible Monitoring**: Allows downstream systems to filter events as needed

## Integration Notes

1. **Multicall Support**: The returned bytes array can be used with multicall patterns
2. **Gas Optimization**: Each subscription is pre-encoded for efficient execution
3. **Chain Agnostic**: Works with any chain ID where the hook is deployed
4. **Event Coverage**: Captures all 4 events defined in the IParityTaxHook interface

## Security Considerations

- **Access Control**: Ensure only authorized addresses can execute subscriptions
- **Rate Limiting**: Consider implementing rate limits for subscription execution
- **Event Validation**: Validate event data before processing in downstream systems
- **Gas Limits**: Be aware of gas limits when executing multiple subscriptions

## Generated By
- **Source**: `ParityTaxHookSubscriptions.sol`
- **Method**: ABI encoding with event topic0 constants
- **Compiler**: Solc 0.8.26
- **Date**: Generated using Foundry development environment
