# `LiquidityTimeCommitmentHook`

## `ADD LIQUIDITY FLOW`

- The data flow is exhibited on the [addLiquidity sequence diagram](../communication/sequenceDiagrams/addLiquidity.excalidraw.png)

## `REMOVE LIQUIDITY FLOW`


## `SWAP FLOW`

### `beforeSwap`

1. `LiquidityTimeCommitmentHook` _asks_ the `LiquidityManager` if it's a desireable swap for `JIT's` to fulfill.

If it's `JIT.fullfillable` then:


   - `LiquidityTimeCommitmentHook` _queries_ the agreggated `JIT` Liquidity available at the `SwapParams` to the `LiquidityManager`.
   - `LiquidityTimeCommitmentHook` _fullfills_ trade with aggregated JIT Liquidity:
   - `LiquidityTimeCommitmentHook` _informs_ trade is to be fullfilled with JIT Liquidity
   with all necessary information to the `LiquidityManager`

   - If not enough `JIT` liquidity:

     - `LiquidityTimeCommitmentHook` _queries_ the agreggated `PLP` Liquidity available at the `SwapParams` to the `LiquidityManager`
     - `LiquidityTimeCommitmentHook` _fullfills_ the remaining portion of the trade request with aggregated PLP Liquidity.
     - `LiquidityTimeCommitmentHook` _informs_ the remaining portion of the trade request is to be fullfilled with PLP Liquidity.

   - If not enough `JIT` liquidity and `PLP` liquidity the trade reverts.

If it's **not** `JIT.fullfillable` then:
   - `LiquidityTimeCommitmentHook` _informs_ `LiquidityManager` trade is to be fully fulfilled by PLP Liquidity
   - `LiquidityTimeCommitmentHook` _ends_ and `PoolManager` excecutes `pool.swap`


### `afterSwap`

2. `LiquidityTimeCommitmentHook` _queries_ the `LiquidityManager` if trade was fullfilled by JIT's

-  If `JIT's` were involved:
   
   -  `LiquidityManager` _queries_ the `PoolManager, PositionManager` for the _JITFeeRevenue_ information generated by the JIT's involved (_known by the `LiquidityManager`_)
   
   -  `LiquidityTimeCommitmentHook` _queries_ the `LiquidityManager` was partially fullfilled by PLP's.
   -  If `PLP's` were involved:
        
        - `LiquidityManager` _appends_ the  _PLPFeeRevenue_ information  to the `FeeRevenueHistoricalDB`
        
        -  `FeeRevenueHistoricalDB` _informs_ the `TaxationSystem` there is new  _PLPFeeRevenue_ information available.
        
        - `TaxationSystem` _asks_ `FeeRevenueHistoricalDB` if there is new _JITRevenue_ information

   -  `LiquidityManager` _appends_ the  _JITFeeRevenue_ information  to the `FeeRevenueHistoricalDB`
   
   -  `FeeRevenueHistoricalDB` _informs_ the `TaxationSystem` there is new  _JITFeeRevenue_ information available.
   
   -  `TaxationSystem` _queries_ `FeeRevenueHistoricalDB` for the needed information needed to return the `Tax`.
   
   -  `TaxationSystem` _sends_ to the `LiquidityManager` the `Tax`
   -  `LiquidityManager` _calculates_ the `revenueCut`
   -  `LiquidityManager` _sends_ `revenueCut` to `LiquidityTimeCommitmentHook`
   -  `LiquidityTimeCommitmentHook` _applies_ the `revenueCut`