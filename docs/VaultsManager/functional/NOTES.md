# `VaultsManager`

- They receive the following data from the `liquidityCommitmentManager.beforeAddLiquidity`:

- The information available to be passed to other entities that is known on `liquidityCommitmentManager.beforeAddLiquidity` context is:

```solidity
function beforeAddLiquidity(
    address sender, // Liquiid
    PoolKey calldata key,
    ModifyLiquidityParams calldata params,    
)

{
 
    if (!(existingTimeCommitment.isJIT) && !(enteredTimeCommitment.isJIT)) {
    // TODO: It needs to adjust the position accordingly
    // NOTE: Since the approach to be taken is liquidity to be stored
    // in the positionManager and managed by ERC-6909 claims
    // we need a "ClaimsManager" instead of "VaultManager",
    // And the claim tokens are the ones stored on "Vaults", in this case
    // PLP vaults, to earn passive income...
    }
    // ---> If the existing position is JIT and the request is JIT it only add more funds to the vaults
    // ==============================JIT -> JIT ===============================================
    if (existingTimeCommitment.isJIT && enteredTimeCommitment.isJIT) {
    // TODO: It only add more funds to the vaults
    // NOTE: In this case the "ClaimsManager" does not route the funds
    // to "PLPVaults" but to "JITClaim" manager that has a reference ta JITHook
    // This hook selects the orders where to apply JIT liquidity
    }
}
```

## `JITHookVaults`

- It is a hook that has `feeRevenue` tracker available only to be queried the `TaxationSystem`

- All `JITHookVault` valid interfaces need to have this function that enables the `TaxationSystem` to know the feeRevenue generated by trades

- It has claim services to manage liquidity from the poolManager

- It has vaults used to hedge position, here the JIT can "hide" funds to not be available for liquidity provision and be available to do other strategies, (lending yield, staking, etc ...) through 'EVC'

(This is only if the funds are not already compromosed for JIT liquidity, becuase the priority is to privde liquidity enforces by the commitment already made when providing liquidity, there ios a mechanism
that handles the case when an orde to be fullfilled is prioritized over other strategies using the funds at a specific moment)...


## `PLPVaults`
- Thi has the vaults for both currencies, it has `EVC` 
dsds
```solidity
interface IVaultManager{
    function routeLiquidity(
        bytes memory encodedCallbackData
    )
    external 
    returns (ILPVault vaultManagerWhereLiquidityWasRoutedTo)
    {
        //1. Route the liquidity optimistically, this is becuase the liquidityManagerHook already verified that the liquidity request is compatible with the LP-type
    }

}

abstract contract VaultManager is IVaultManager, BaseHook{
    
    PLPVaults;
    JITVaults;

    function beforeSwap(
        address sender,
        PoolKey calldata key, 
        SwapParams calldata params,
        bytes calldata hookData
        )
        external
        onlyPoolManager
        returns (bytes4, BeforeSwapDelta, uint24){
            
            //1. It calls the JITVaults and presnet the swapReques
            
            //2. The JITVaults each has it's JIJTHook where each
            // figure out if they wnat to fullfill or not the trade
            
            // --> If fullfilled on afterSwap it queries the feesEarned
            // by the JIT's and store it accrdincly
            // --> If no one wnats to fullfill the trade then it is passed 
            // to egular swapping logic using PLP liquidity, where on afterSwap 
            // it also keep track of the revenue gained by PLP's

            //3. Finally it calls the taxSystem to determine the tax for this
            // trade applied to JIT's
            
            // 4. Tax is appplied and tax revenue is transfered to PLP's 
        }
}
abstract contract LPVault{
    using TaxMath for feesEarned;

    mapping(Vault[2] => feesEarned) private feesEarned;
}

abstract contract JITVaultManager is VaultManager{
    

    JITHook private jitHook;
    
    // Variables related to keep track of fees Transfered to PLP lP's
}

abstract contract PLPVaultManager is VaultManager{
    //Locking related state variables

    // Variables associated with other income sources for locked
    // funds

    // Variables related to keep track of fees Transfered from JIT lP's

}

```